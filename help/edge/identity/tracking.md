---
title: Tracking Adobe Experience Clouds IDs (ECIDs) in the Platform Web SDK
description: Learn the different methods for tracking users and devices using first-party or third-party cookies.
---
# Tracking Adobe Experience Cloud IDs (ECIDs) in the Platform Web SDK

Adobe Experience Platform Web SDK leverages the [Adobe Identity Service](https://experienceleague.adobe.com/docs/experience-platform/identity/ecid.html?lang=en). Use of this service ensures that each device has a unique identifier that can persist across multiple sessions, thus tying all the hits that occur during and across web sessions to a specific device. 

## Device Identification

When a new user arrives on the site of an Adobe Customer, the Identity Service attempts to set a device identification cookie. For first-time visitors, the ECID is generated and returned in the first response from the Adobe Experience Edge Network. For repeat visitors, the ECID is retrieved from the kndctr_{YOUR-ORG-ID}_AdobeOrg_identity cookie and added to the payload. Once the cookie containing the ECID has been set, each subsequent request generated by the Adobe Experience Platform Web SDK will include the ECID. 

## Device Identification Options

Adobe customers have a two options to interact with the Adobe Experience Platform Data Collection Edge. Data can be sent directly to the Edge Network domain `adobedc.net`; this will be referred to as third-party data collection. Adobe customers also have the option to create a CNAME on their own domain that points to `adobedc.net`; this will be referred to as CNAME first-party data collection. The data collection method customers choose to use will have an impact on cookie lifetime across browsers.

### Third-Party Data Collection

In recent years, web browsers have becoming increasingly restrictive in their handling of cookies set by third parties. Some browsers block third-party cookies by default. In scenarios where customers may choose to allow third-party cookies, the lifetime of those cookies is almost always shorter than what would be otherwise available using a first-party cookie to identify site visitors. In some cases, this cookie will expire in as little as seven days. Additionally, when third-party data collection is used, some ad-blockers restrict traffic to Adobe data collection endpoints all together. 

### First-Party Data Collection

While browsers have long treated cookies set by CNAME endpoints in a similar manner to those set by site-owned endpoints. Recent changes implemented by browsers have created a distinction in how CNAME cookies are handled. While there are no browsers that currently block first-party CNAME cookies by default, some browsers restrict the lifetime of cookies set using a CNAME to just seven days. 

### Effects of Cookie Lifetime on Adobe Experience Platform Solutions ###

Regardless of whether you choose first-party or third-party data collection, the length of time a cookie can persist with have an impact on visitor counts in Adobe Analytics or Customer Journey Analytics. Additionally, end users may experience inconsistent personalization experiences when Adobe Target or Offer Decisioning is used on the site. For example, let's say I have created a personalization experience that will promote any item a user has viewed three times in the course of seven days to the home page. If an end-user visits three times in a week and then does not return to the site for seven days, depending on the browser the end-user uses to visit the site, that use could be considered a new user when they return to the site because their cookies may have been deleted by a browser policy. If this occurs, your Analytics tool will treat the visitor as a new user even though they visited the site just a little over seven days ago. Additionally, any effort to personalize the experience for the user, will begin again. 

## First-Party Device IDs

As a way to comply with the changes outlined above, some Adobe customers may find benefit in setting and managing their own device identifiers. For customers who choose to do this, Adobe Experience Platform Edge Network will now accept customer generated device IDs. First party cookies are most effective when they are set using a customer-owned server that leverages a DNS A-record as opposed to a DNS CNAME. The First Party Device ID functionality allows customers to set device IDs in cookies using DNS A-records. These IDs can then be sent to Adobe and used as seeds to generate ECIDs that will continue to be the primary identifiers in the Adobe Experience Cloud and Adobe Experience Platform solutions. 

If you are using the default, `edge.adobedc.net` endpoint with no CNAME, the First Party Device ID must be included in the Identity Map. However, if you leverage First-Party data collection, meaning you have configured a CNAME that points to `edge.adobedc.net`, you can specify a cookie name in the Datastreams configuration where the Adobe Experience Edge Network will be able to locate the cookie that contains the First Party Device ID. 

>[!NOTE]
>
>The First-Party Device ID solution is only available for customers when sending data to the Adobe Experience Platform Edge Network via the AEP Web SDK.

## UUIDv4

The Adobe Experience Platform Edge Network will accept IDs that comply with the UUID version-4 format. Further information about the UUIDv4 format can be found [here](https://datatracker.ietf.org/doc/html/rfc4122). Device IDs that are not in UUID version-4 format will be rejected. 

The primary reason the UUIDv4 is the only acceptable ID format is that generation of a UUID will  almost always result in a unique, random ID being generated. The probability of a collision occurring is also incredibly small. UUID version-4 can not be seeded using IP addresses or any other PII. 

UUIDs are ubiquitous and libraries can be found for virtually every programming language to generate them. 

## How to set a cookie using a DNS A-record

A variety of methods can be used to set a cookie in a way that will prevent it from being restricted due to browser policies: 

* Cookies can be generated using server-side scripting languages
* Cookies can be set in response to an API request made to a sub-domain or other endpoint on the site
* Cookies generated by a CMS
* Cookies generated by a CDN

>[!NOTE]
>
>Cookies set using JavaScript's `document.cookie` method will almost never be protected from browser policies that restrict cookie durations. 
9:32
## When to set the First-Party Device ID cookie

In an ideal scenario, the First-Party Device ID cookie should be set before making any requests to Adobe's data collection network. However, in scenarios where that is not possible to set the FPID  before any requests are made, an ECID will still be generated using existing methods and will be the primary identifier as long as the cookie exists. Assuming the ECID is eventually impacted by a browser deletion policy, but the FPID is not, the FPID will become the primary identifier on the next visit and will be used to seed the ECID on each subsequent visit. 

## Setting the expiration of for a cookie

Setting the expiration of a cookie is something that should be carefully considered as you implement the First-Party Device ID functionality. When making this decision, you should take into account the countries or regions in which your organization operates along with the laws and policies in each one of those regions. 

As part of this decision, you may want to adopt a company-wide cookie setting policy or one that varies for users in each locale where you operate. 

Regardless of the setting you choose for the initial expiration of a cookie, you'll want to ensure you include logic that extends the expiration of the cookie each time a new visit to the site occurs. 

## Impact of Cookie Flags

A variety of cookie flags exist that impact the how cookies are treated across different browsers. 

### HTTPOnly

Cookies set using the **HTTPOnly** flag cannot be accessed using client-side scripts. This means that if you set this HTTPOnly flag when setting the a First-Party Device ID, you must leverage a server-side scripting language to read the cookie value for inclusion in the Identity Map. If you choose to have the Experience Platform Edge Network read the value of the First-Party Device ID Cookie, setting the **HTTPOnly** flag will ensure the value is not accessible by any client-side scripts but will not have any negative impact on the Adobe Experience Platform Edge Network's ability to read the cookie. 

>[!NOTE]
>
>Use of the HTTPOnly flag does not have an impact on the Cookie Policies that may restrict cookie lifetime. However, it is something you should consider as you set and read the value of the First-Party Device ID 

### Secure

Cookies set with the **Secure** attribute are only sent to the server with an encrypted request over the HTTPS protocol. Use of this flag can help ensure man-in-the-middle attackers cannot easily access the value of the cookie. When possible, it is always a good idea to set the **Secure** flag 

### SameSite

The SameSite attribute lets servers determine whether cookies are sent with cross-site requests. The attribute provides some protection against cross-site forgery attacks. Three possible values exist: `Strict`, `Lax` and `None`. Again, you'll need to consult internally to determine which setting is right for your organization. If no SameSite attribute is specified, the default setting for some browsers is now `SameSite=Lax`. 

Below is an example of how you would set an FPID on it's own in the Identity Map:

```
{
    "identityMap": {
        "FPID": [
        {
            "id": "123e4567-e89b-42d3-9456-426614174000",
            "authenticatedState": "ambiguous",
            "primary": true
        }
    }
}
```

Here is an example of the FPID and an Authenticated CRM ID in the Identity Map:

```
{
    "identityMap": {
        "FPID": [
        {
            "id": "123e4567-e89b-42d3-9456-426614174000",
            "authenticatedState": "ambiguous",
            "primary": true
        }
        ],
        "EMAIL": [
            {
                "id": "email@mail.com",
                "authenticatedState": "authenticated",
                "primary": true
            }
        ]
    }
}
```

If the FPID is contained in a cookie being read by the Edge Network when First-Party Data collection is enabled, below is an example of how you would capture only the authenticated CRM ID. 

```
{
    "identityMap": {
        "EMAIL": [
            {
                "id": "email@mail.com",
                "authenticatedState": "authenticated",
                "primary": true
            }
        ]
    }
}
```


The following identityMap field group will result into an error response when set on a server data-stream request as it is missing the primary indicator for the FPID. This is due to the fact that neither ID has been marked as primary. 

```
{
    "identityMap": {
        "FPID": [
            {
                "id": "123e4567-e89b-12d3-a456-426614174000",
                "authenticatedState": "ambiguous"
            }
        ],
        "EMAIL": [
            {
                "id": "email@mail.com",
                "authenticatedState": "authenticated"
            }
        ]
    }
}
```

The error response returned by Experience Edge in this case is similar to the following:

```
{
    "type": "https://ns.adobe.com/aep/errors/EXEG-0306-400",
    "status": 400,
    "title": "No primary identity set in request (event)",
    "detail": "No primary identity found in the input event. Update the request accordingly to your schema and try again.",
    "report": {
        "requestId": <requestId>,
        "configId": <configId>,
        "orgId": <orgId>
    }
}
```

### ID Hierarchy

When both an ECID and FPID are present, the ECID will be prioritized in identifying the user. This will ensure that when an existing ECID is present in the browser cookie store, we'll continue to use it as the primary identifier and existing visitor counts do not risk being cliffed. For existing users, the FPID will not the primary identity until the ECID has either been deleted manually, it expires, or is deleted as as result of a browser policy.

|ID   |
|---|
|ECID included in the Identity map|
|ECID stored in a cookie|
|FPID included in the Identity map|
|FPID stored in a cookie|


## First-Party Device IDs FAQ 

**How is seeding an ID different from simply generating an ID?** 

The concept of seeding is unique in that the FPID passed to the Adobe Experience Cloud will be converted to an ECID using a deterministic algorithm. Each time the same FPID is sent the Adobe Experience Platform Edge Network, the same ECID will be seeded from the FPID. 

**When should the First-Party Device ID be generated**

To reduce potential visitor inflation, the FPID should be generated prior to making your first request using the AEP Web SDK. However, if you are unable to do this, an ECID will still be generated for that user and will be used as the primary identifier. The FPID that was generated will not become the primary identifier until the ECID is no longer present. 

**Which data collection methods support the First-Party Device ID**

Currently, the **AEP Web SDK** supports the FPID. 

**Is the FPID stored on any Platform or Experience Cloud solutions**

No, once the FPID has been used to seed an ECID, it is dropped from the Identity map and replaced with the ECID that has been generated. The FPID is not stored in any Adobe Experience Platform or Experience Cloud solutions. 

## First-Party Device Migration

![migration](images/5visits.png)

Let's review a scenario that involves a customer who has previously visited your site and what impact migration to use of a First-Party Device Identifier would have on how they are identified in Adobe solutions. 

**First Visit**
Assume you've not yet started setting the FPID cookie. The ECID contained in the AMCV cookie will be the identifier used to identify the visitor. 

**Second Visit**
Rollout of the First-Party Device ID solution has started. The existing ECID is still present and is continues to be the primary identifier for visitor identification. 

**Third Visit**
Between the second and third visit, a sufficient amount of time has elapsed that the ECID has been deleted due to browser policy. However, because the FPID was set using a DNS A-record, the FPID persists. The FPID is now considered the primary ID and used to seed the ECID which is written to the end-user device. The user would now be considered a new visitor in the Adobe Experience Platform and Experience Cloud solutions. 

**Fourth Visit** 
Between the third and fourth visits, a sufficient amount of time has elapsed that the ECID has been deleted due to browser policy. Like the previous visit, the FPID remains due to the manner in which it was set. This time, the same ECID is generated as the previous visit. The user is seen throughout the Experience Platform and Experience Cloud solutions as the same user as the previous visit. 

**Fifth Visit**
Between the fourth and fifth visits, the end-user cleared all the cookies in their browser. A new FPID is generated and used to seed the creation of a new ECID. The user would now be considered a new visitor in the Adobe Experience Platform and Experience Cloud solutions. 
