---
description: 
title: Error handling
---

# Error handling

Errors in Edge Gateway can have a variety of causes, internal (Edge Gateway itself) or external (input, configuration, or upstreams). 

## Errors hierarchy {#hierarchy}

| Error | Type | Description |
| --- | --- | --- |
| `InputError` | External | <ul><li>Includes errors caused by malformed input, as well as entity validation errors</li><li>Generally translates into a **4xx status code**</li></ul> |
| `ConfigurationError` | External | <ul><li>Errors that mostly deal with server-side configuration</li><li>Generally translates into a **422 status code**</li></ul> |
| `RequestProcessingError` | Internal | <ul><li>General-purpose error issued by Edge Gateway on unexpected circumstances</li><li>Generally translates into a **500 status code**</li></ul> |
| `UpstreamError` | External | <ul><li>Captures errors that occurred while communicating with upstream services</li><li>Upstream errors will translate to status code **207 (Multi Status)**</li></ul> |

## Severity

Another way to look at errors is by their severity:

* **Fatal errors** will halt the dispatch pipeline
* **Non-fatal errors** could signal a partial processing, while allowing for request processing to continue
  * When present, the overall status code of the request will be changed to `207 Multi-Status`.

| Error | Type | Remarks |
| --- | --- | --- |
| `InputError` | Fatal | Happens when accepting the request, before dispatching it to upstreams. |
| `ConfigurationError` | Fatal | Happens when accepting the request, before dispatching it to upstreams. |
| `RequestProcessingError` | Fatal | Can happen at any point during request processing. |
| `UpstreamError` | Non-Fatal | |

### Fatal errors

Fatal errors halt the request processing and cause a **non-2xx response status** to be returned. Check out the [error hierarchy](#hierarchy) section to see the expected status code, corresponding to each error type.

Errors will be accompanied by a response body containing an error object. In this case, the response body contains a problem detail, as defined by [RFC 7807 Problem Details for HTTP APIs](https://tools.ietf.org/html/rfc7807).

The returned content-type is the `application/problem+json` media type. When present, this response contains machine-readable details pertaining to the error. Problem details include a type, which is a URI.

All error objects have a `type`, `status`, `title`, `detail` and `report` message properties so that the API client can tell what the problem is.

| Property | Type   | Description |
| -------- | ------ | ----------- |
| `type`	   | string | A URI reference (RFC3986) that identifies the problem type, following the format `https://ns.adobe.com/aep/errors/<ERROR-CODE>`. |
| `status`   | number | The HTTP status code generated by the server for this occurrence of the problem. |
| `title`    | string | A short, human-readable summary of the problem type. |
| `detail`   | string | A short, human-readable description of the problem type. |
| `report`   | object | A map of additional properties that aid in debugging such as the request ID or the org ID. In some cases, it might contain data specific to the error at hand, such as a list of validation errors. |

```json
{
  "type" : "https://ns.adobe.com/aep/errors/EXEG-0104-422",
  "status": 422,
  "title" : "Unprocessable entity",
  "detail": "Invalid request (report attached). Please check your input and try again.",
  "report": {
    "errors": [
      "Allowed Adobe version is 1.0 for standard 'Adobe' at index 0",
      "Allowed IAB version is 2.0 for standard 'IAB TCF' at index 1",
      "IAB consent string value must not be empty for standard 'IAB TCF' at index 1"
    ],
    "requestId": "0f8821e5-ed1a-4301-b445-5f336fb50ee8",
    "orgId": "53A16ACB5CC1D3760A495C99@AdobeOrg"
  }
}
```
<!-- panels:end -->

### Non-fatal errors

Non-fatal errors can be further broken down into:

* Errors: issues that occurred while processing the request, but did not cause the entire request to be rejected (eg. a non-critical upstream failure)
* Warnings: messages from upstreams which could signal that a partial processing of the request occurred

When encountering non-fatal errors (excluding warnings), Edge Gateway will change the response status to **207 Multi-Status**.

Warnings, on the other hand, are mostly informative, as they generally represent a potentially transient condition, which did not impact the request to full extent. One example here is a partial profile read in the segmentation engine, in which case the accuracy is impacted to some degree, but the functionality is still delivered.

Non-fatal errors are represented in the _Problem Details_ format, but are embedded directly in Edge gateway's standard response, which is of type `application/json`.

```json
{
  "requestId": "72eaa048-207e-4dde-bf16-0cb2b21336d5",
  "handle": [
  ],
  "errors": [
    {
      "type": "https://ns.adobe.com/aep/errors/EXEG-0201-503",
      "status": 503,
      "title": "The 'com.adobe.experience.platform.ode' service is temporarily unable to serve this request. Please try again later."
    }
  ],
  "warnings": [
    {
      "type": "https://ns.adobe.com/aep/errors/EXEG-0204-200",
      "status": 200,
      "title": "A warning occurred while calling the 'com.adobe.audiencemanager' service for this request.",
      "report": {
        "cause": {
          "message": "Cannot read related customer for device id: ...",
          "code": 202
        }
      }
    }
  ]
}
```

## Handling 4xx and 5xx Responses

### Handling `4xx (Bad Request)`

Most 4xx errors like 400, 403, 404 _MUST not be retried_ (except 429 discussed next) on behalf of the client as these are client errors and will not succeed. _The client MUST address the error_ and resend the request.

### Handling `429 Too Many Requests`

429 HTTP response code indicates that Edge Gateway or an upstream service is rate limiting the requests. In such a scenario _the invoker MUST respect the `Retry-After` response header_ to retry. Any responses flowing back MUST carry the HTTP response code with a domain specific error code.

### Handling `500 Internal Server Error`

500 errors are generic catch all errors. _500 errors MUST not be retried_ (except 502s and 503s discussed next). Intermediaries MUST respond with a 500 and MAY respond with a generic error code/message, or a more domain specific error code/message.

### Handling `502 Bad Gateway`

Indicates that Edge Gateway received an invalid response from upstream server(s), which could happen due to network issues between servers. The temporary network issue may resolve and thus a retry MAY resolve the issue, so _recipients of 502s MAY retry the request_ after a sufficient interval.

### Handling `503 Service Unavailable`
This error code indicates that the service is temporarily unavailable, this can happen during maintenance periods. In such scenarios the _recipients of 503 MAY choose to retry_ but MUST respect the `Retry-After` header.

### Handling `504 Gateway Timeout`

Indicates that Edge Gateway's request to the upstream server(s) timed-out, which can happen due to network issues between servers, DNS issues, etc. The temporary network issues may resolve and _a retry MAY be appropriate_ and MAY resolve the issue.
